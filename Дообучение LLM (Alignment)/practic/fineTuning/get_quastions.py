#!/usr/bin/env python3

import os
from dotenv import load_dotenv
from yandex_cloud_ml_sdk import YCloudML

load_dotenv()

def main():
    api_key = os.getenv("YANDEX_API")
    folder_id = "b1ge6b93hbtf0j5b7ptt"

    if not api_key:
        raise ValueError("Ошибка: YANDEX_API не найден в .env файле")

    sdk = YCloudML(folder_id=folder_id, auth=api_key)
    sdk.setup_default_logging()

    # 1️⃣ создаём модель (можно заменить на yandexgpt)
    model = sdk.chat.completions("yandexgpt-lite")

    # 2️⃣ конфигурируем параметры (температура и т.п.)
    model = model.configure(temperature=0.3, max_tokens=512)

    # 3️⃣ формируем запрос
    messages = [
        {"role": "system", "text": "Найди ошибки в тексте и исправь их"},
        {
            "role": "user",
            "text": "Ты — эксперт по книге \"Трое из леса\" Юрия Никитина. На основе приведенного отрывка сгенерируй 2-3 фактологических вопроса, ответы на которые непосредственно содержатся в тексте.\n\nОтрывок: Тяжелые ночные запахи перепрелого дерева качнулись и, как донные рыбы, опустились, унося смутные видения и страхи. Он высунул голову и, ослепленный ярким светом, задохнувшийся обжигающим воздухом, недоверчиво всматривался в мир. На земле свежие оттиски волчьих лап, но это кто-то из своих, а вот на дереве напротив -- следы когтей крупной совы. Недобрый знак... Кряхтя, он полез наружу. Воздух был свежий и влажный, утоптанная земля блестела росой. Деревья-великаны окружили исполинскую поляну плотной стеной. Ветви над ней переплелись, в темной зелени постоянно шебаршится, шевелится, вниз то и дело падают чешуйки коры, листья, сыпятся шерстинки и перья. Нередко, окровавленные. За ночь землю кое-где вспучило, а у могучего дуба, где в дупле живет семья Годовита, даже пробился зеленый росток. Если не уничтожить к вечеру, завтра война с Лесом будет куда труднее... Дожили, подумал Боромир с облегчением. Самой большой заботой его племени было дожить до весны, до тепла, до солнца, которого никто из племени не видел, но все знали, что с весны оно начинает прогревать деревья и землю. Из ямы, закрытой сверху стволами деревьев и пластами дерна, выползали голые дети Громобоя, старшего Охотника. За ними тянулся запах нечистот и вони, все в толстой корке грязи, с бледными лицами, красными глазами и распухшими кровоточащими деснами. Старшие были в лохмотьях перепрелых шкур, но с такой же засохшей кровью на губах, слабые, блеклые. Едва вылезли, расселись как воронята на длинной валежине, ослабелые ноги держат худо. Кто покрепче, ковылял до Реки. Лед давно сошел, вода бежала, прыгая по камням, чистая как рыба, и дети, помогая друг дружке, переходили по камням на ту сторону Реки. Там просто Лес, предтеча неведомому Чернолесью, куда не ступала нога человека, и в этом лесу дети, не отходя от берега и не теряя из виду приметные деревья, рылись в ворохе прошлогодних листьев, находили плоские стебельки лука, молодые листочки папоротника, крапивы, рвали и тут же старательно жевали, чувствуя как живительные капли вливаются в ослабевшие тельца, поддерживают уже было затухшие искорки жизни. Как козы объедали молодые веточки тальника и орешника, обагряя кровью из десен.\n\nМетаданные: {'author': 'Юрий Никитин', 'book_name': 'Трое из леса', 'part': 'ЧАСТЬ ПЕРВАЯ', 'chapter': 'Глава 1'}\n\nИнструкции:\n- Вопросы должны быть конкретными и фактологическими (Кто? Что? Где? Когда?)\n- Ответ должен однозначно содержаться в отрывке\n- Избегай общих и интерпретационных вопросов\n- Формулируй вопросы так, чтобы они были самодостаточными\n\nСгенерируй вопросы в формате JSON:\n{\n  \"questions\": [\"вопрос1\", \"вопрос2\", \"вопрос3\"]\n}",
        },
    ]

    # 4️⃣ отправляем запрос
    result = model.run(messages)

    # 5️⃣ выводим результат
    print("Исправленный текст:\n")
    print(result.text)

if __name__ == "__main__":
    main()
